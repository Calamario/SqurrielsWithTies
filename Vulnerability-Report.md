# Vulnerability Result

## Broken Access Control
#### Exposure
We found some instances of Broken Access Control
on some controllers. It didn't contain any Authorize
tags and allowed for non-users to access protions of the 
page. 

This allowed access to non-users seeing order history
of other users through url manipulation.

#### Repair
Simply attaching [Authorize] and bringing in the Authorize library 
helped solve this issue. We also went and attached Authorize tags to
View Components just in case as well.
```
[Authorize(Policy = "AdminOnly")]
public class ProductController : Controller
```

#### Resource
* [OWASP .NET Security](https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance)
* [.NET Core Tutorials](https://dotnetcoretutorials.com/2017/12/15/owasp-top-10-asp-net-core-broken-access-control/)

## Cross-Site Scripting (XSS)
#### Exposure
XSS can also be injected into styles page and attackers can change
the layout of the page. It can give misleading information or redirect the user
into giving precious information. Our links to style pages also are vulnerable to this
and thus we planned on encoding the HTML.

#### Repair
This is done by installing a nuget package to your Visual Studio.
```	
InstallI -Package Microsoft.AspNet.WebUtilities -Pre
```
Then, hrefs on link or anchor tags can be given a query to encode the text.
```
href="/~/CSS/Home.css?query=@System.Net.WebUtility.UrlEncode(Context.Request.Query["query"]
```

#### Resource
* [OWASP .NET Security](https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance)
* [.NET Core Tutorials](https://dotnetcoretutorials.com/2017/10/25/owasp-top-10-asp-net-core-cross-site-scripting-xss/)

## SQL Injection
#### Exposure
When searching through a table in a database, endpoints are used to display the requested data. These endpoints are displayed in the browser's URL. 
If the afformented database contains multiple tables, and one or more of those tables have sensitive information, anyone could type SQL commands in the URL to combine said tables and display sensitive information (or even delete the entire table). 

#### Repair

We can prevent SQL injections by first using the entity framework. We also use linq to ensure that the queries we run aren't suseptible to exposure. 

```
    using Microsoft.EntityFrameworkCore;
    using System.Linq;
```

```
   Basket basket = await _context.BasketTable.FirstOrDefaultAsync(b => b.ID == k.BasketID);    
   var basketItems = await _context.BasketItemTable.Where(x => x.BasketID == basket.ID).ToListAsync();
```

#### Resources
* [DotNetCoreTutorials](https://dotnetcoretutorials.com/2017/10/11/owasp-top-10-asp-net-core-sql-injection/)* [Microsoft Docs](https://docs.microsoft.com/en-us/ef/core/querying/raw-sql)* [OWASP .NET](https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance)## Broken Authentication And Session Management#### ExposureThis deals with password protection and database separation. When sensitive information is stored on a table within the same database as other tables, any breach exposes all tables. This also deals with user error, like easily guessed passwords and ensuring that sessions don't persist to allow other users to impersonate another. #### RepairWe can prevent many of the issues that surround Broken Authentication and Session Management by using the ASP.net Core Identity framework. This will secure our passwords to ensure that they are properly hashed and stored. That includes Password requirements for users to ensure that their passwords are not easily guessed. (Minimum Password Length, integer requirement, and special character requirement). ```using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Identity.UI.Services;``````[Required]
[DataType(DataType.Password)]
public string Password { get; set; }

[Required]
[DataType(DataType.Password)]
[Display(Name = "Confirm password")]
public string ConfirmPassword { get; set; }```#### Resources* [Dot Net Core Tutorials](https://dotnetcoretutorials.com/2017/10/16/owasp-top-10-asp-net-core-broken-authentication-session-management/)* [OWASP.org](https://www.owasp.org/index.php/.NET_Security_Cheat_Sheet#ASP.NET_MVC_Guidance)